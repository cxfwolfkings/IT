2020-05-06
计划：
1、知识库不规则瀑布流
2、预览测试
3、文档库权限控制
4、bug修复
实际：
1、和需求细化消息角标相关的需求
2、知识库前端界面

2020-05-07
计划：
https://mbd.baidu.com/newspage/data/landingsuper?context=%7B%22nid%22%3A%22news_10095808786748896089%22%7D&n_type=0&p_from=1
https://www.cnblogs.com/sfencs-hcy/p/10341449.html
1、文档库
2、bug修复
3、项目名称可输入特殊字符，项目申请单撤回，项目变更单撤回，客户可编辑
4、复杂表单

2020-05-08

实际：
1、工时报表逻辑阐述，释疑
2、问题操作习惯表分片规则修改，查询语句测试
3、子项目组名称没有读出来（下拉框取值）

2020-05-11

实际：
1、文档上传模态框开发基本完成
2、文档目录模态框组织人员树和可见范围标签的联动完善，基本完成
3、文档目录授权增删改相关后台接口编写，基本完成

2020-05-12

1、工时报表bug修复
2、知识库根据客户筛选的后台逻辑代码修复
3、文档库组织结构树筛选相关前端交互优化
4、组织结构树后端查询代码更新优化

2020-05-13

1、增加txt文件的预览，解决字符串乱码问题
2、增加下载按钮，对于可下载文件增加下载功能
3、102服务器上部署upload微服务，注册到测试环境服务中心
4、文档库自测，修复bug，优化代码
5、项目ERP号、名称、客户相关功能优化

2020-05-14

1、项目ERP号可增加多个的功能更新，相应前端界面和后端逻辑代码、数据表更新
2、项目列表筛选，项目变更等涉及ERP号，客户号的相关代码更新
3、文档库自测，测试多文件上传和预览

2020-05-21

1、测试102服务器文件上传，读取速度
2、设备型号字段的属性验证更新
3、项目相关组的验证、可编辑等bug修复
4、发布项目、文档、上传、预览微服务，解决部署问题

2020-05-22
1、编写脚本，历史记录的项目名称上拼接设备型号

2020-05-23

1、项目合并脚本编写，完成90%

2020-05-25

1、项目合并脚本编写完成，执行脚本
2、项目申请单撤回功能添加，基本完成
3、任务申请单撤回功能添加，完成50%

2020-05-26

1、任务申请单撤回功能更新，完成90%
2、Dapper基础库代码更新，发布
3、15分钟不操作退出时，添加密码确认框，后台逻辑类似登录，完成80%

2020-06-02

1、Dev分支合并代码，切换bugfix分支，修改项目列表ERP号显示（线上环境），自测并合并回Dev分支
2、项目管理模块的接口更新，使用通用的结果视图返回，完成20%

2020-06-03

1、项目管理模块接口更新，使用通用的结果视图返回，基本完成
2、知识管理模块接口更新，使用通用的结果视图返回，基本完成

2020-06-04

1、编写项目合并功能的小程序，自测并执行，对用户需求的几十个项目进行合并
2、发布正式环境前后端，迁移正式数据库
3、认证服务，读取服务接口加入业务功能解决方案，恢复至master分支的版本，和开发分支分离

2020-06-08

1、项目申请单、任务申请单撤回的后台功能完善，申请单列表数据过滤
2、参加考勤需求会议，了解考勤需求，为数据库设计作准备
3、修改正式数据库中项目表设备型号、项目名称的历史数据，用逗号替换斜杠；排查任务邮件发送问题
4、认证微服务后端代码更新，直接完成登录功能，不再发送两次请求

2020-06-10

1、排查开始任务消失问题（原因：由项目合并引起，作为保留的项目未开始；解决方法：项目开始后，任务会自动显示）
2、设计并创建考勤系统相关数据表
3、将CS端的更新服务配置到API网关中，可以用网关地址下载新版本程序

备忘：

15136：ZLSzls305714546
23712：Liutianlong940213


未执行：
----
钱芹：CD栋三楼东办公室领取生日礼物
每天查看一下项目负责人所在组是否正确！
101数据库：添加逻辑删除字段 IS_DELETE，默认值：0
BIZ_DAILY、BIZ_QUESTION、BIZ_APPROVED_TASK、BIZ_PROJECT、biz_project_task、biz_projtask_form

C#处理MySQL长度为1位的数值时，会自动转化为bool类型！

INSERT INTO `BAS_MENU`(`MENU_NAME`,`MENU_ROUTE`,`LEVEL`,`PARENTID`,`STATUS`,`CREATE_DATE`, `UPDATE_DATE`) VALUES
('考勤组','AttenceRule',1,0,1,NOW(),NOW());
INSERT INTO `BAS_MENU`(`MENU_NAME`,`MENU_ROUTE`,`LEVEL`,`PARENTID`,`STATUS`,`CREATE_DATE`, `UPDATE_DATE`) VALUES
('考勤待办','AttenceTask',1,0,1,NOW(),NOW());
INSERT INTO `BAS_MENU`(`MENU_NAME`,`MENU_ROUTE`,`LEVEL`,`PARENTID`,`STATUS`,`CREATE_DATE`, `UPDATE_DATE`) VALUES
('我的申请','MyRequest',1,(SELECT ID FROM `bas_menu` m WHERE MENU_NAME = '考勤待办'),1,NOW(),NOW());
INSERT INTO `BAS_MENU`(`MENU_NAME`,`MENU_ROUTE`,`LEVEL`,`PARENTID`,`STATUS`,`CREATE_DATE`, `UPDATE_DATE`) VALUES
('审批申请','MyApproved',1,(SELECT ID FROM `bas_menu` m WHERE MENU_NAME = '考勤待办'),1,NOW(),NOW());
INSERT INTO `BAS_MENU`(`MENU_NAME`,`MENU_ROUTE`,`LEVEL`,`PARENTID`,`STATUS`,`CREATE_DATE`, `UPDATE_DATE`) VALUES
('归档申请','MyArchive',1,(SELECT ID FROM `bas_menu` m WHERE MENU_NAME = '考勤待办'),1,NOW(),NOW());
INSERT INTO `BAS_MENU`(`MENU_NAME`,`MENU_ROUTE`,`LEVEL`,`PARENTID`,`STATUS`,`CREATE_DATE`, `UPDATE_DATE`) VALUES
('考勤日历','AttenceCalendar',1,0,1,NOW(),NOW());
INSERT INTO `BAS_MENU`(`MENU_NAME`,`MENU_ROUTE`,`LEVEL`,`PARENTID`,`STATUS`,`CREATE_DATE`, `UPDATE_DATE`) VALUES
('考勤核对','AttenceCheck',1,0,1,NOW(),NOW());
INSERT INTO `BAS_MENU`(`MENU_NAME`,`MENU_ROUTE`,`LEVEL`,`PARENTID`,`STATUS`,`CREATE_DATE`, `UPDATE_DATE`) VALUES
('办公地点维护','SettingCompany',1,25,1,NOW(),NOW());
INSERT INTO `BAS_MENU`(`MENU_NAME`,`MENU_ROUTE`,`LEVEL`,`PARENTID`,`STATUS`,`CREATE_DATE`, `UPDATE_DATE`) VALUES
('节假日维护','SettingHoliday',1,25,1,NOW(),NOW());

INSERT INTO `BAS_ROLE_MENU`(`ROLE_ID`,`MENU_ID`,`STATUS`,`CREATE_DATE`,`UPDATE_DATE`) VALUES
('6F9619FF8B86D011B42D00C04FC964FF',(SELECT ID FROM `bas_menu` WHERE MENU_NAME = '考勤组'),1,NOW(),NOW());
INSERT INTO `BAS_ROLE_MENU`(`ROLE_ID`,`MENU_ID`,`STATUS`,`CREATE_DATE`,`UPDATE_DATE`) VALUES
('6F9619FF8B86D011B42D00C04FC964FF',(SELECT ID FROM `bas_menu` WHERE MENU_NAME = '考勤待办'),1,NOW(),NOW());
INSERT INTO `BAS_ROLE_MENU`(`ROLE_ID`,`MENU_ID`,`STATUS`,`CREATE_DATE`,`UPDATE_DATE`) VALUES
('6F9619FF8B86D011B42D00C04FC964FF',(SELECT ID FROM `bas_menu` WHERE MENU_NAME = '我的申请'),1,NOW(),NOW());
INSERT INTO `BAS_ROLE_MENU`(`ROLE_ID`,`MENU_ID`,`STATUS`,`CREATE_DATE`,`UPDATE_DATE`) VALUES
('6F9619FF8B86D011B42D00C04FC964FF',(SELECT ID FROM `bas_menu` WHERE MENU_NAME = '审批申请'),1,NOW(),NOW());
INSERT INTO `BAS_ROLE_MENU`(`ROLE_ID`,`MENU_ID`,`STATUS`,`CREATE_DATE`,`UPDATE_DATE`) VALUES
('6F9619FF8B86D011B42D00C04FC964FF',(SELECT ID FROM `bas_menu` WHERE MENU_NAME = '归档申请'),1,NOW(),NOW());
INSERT INTO `BAS_ROLE_MENU`(`ROLE_ID`,`MENU_ID`,`STATUS`,`CREATE_DATE`,`UPDATE_DATE`) VALUES
('6F9619FF8B86D011B42D00C04FC964FF',(SELECT ID FROM `bas_menu` WHERE MENU_NAME = '考勤日历'),1,NOW(),NOW());
INSERT INTO `BAS_ROLE_MENU`(`ROLE_ID`,`MENU_ID`,`STATUS`,`CREATE_DATE`,`UPDATE_DATE`) VALUES
('6F9619FF8B86D011B42D00C04FC964FF',(SELECT ID FROM `bas_menu` WHERE MENU_NAME = '考勤核对'),1,NOW(),NOW());
INSERT INTO `BAS_ROLE_MENU`(`ROLE_ID`,`MENU_ID`,`STATUS`,`CREATE_DATE`,`UPDATE_DATE`) VALUES
('6F9619FF8B86D011B42D00C04FC964FF',(SELECT ID FROM `bas_menu` WHERE MENU_NAME = '节假日维护'),1,NOW(),NOW());
INSERT INTO `BAS_ROLE_MENU`(`ROLE_ID`,`MENU_ID`,`STATUS`,`CREATE_DATE`,`UPDATE_DATE`) VALUES
('6F9619FF8B86D011B42D00C04FC964FF',(SELECT ID FROM `bas_menu` WHERE MENU_NAME = '办公地点维护'),1,NOW(),NOW());

-- 补充最后的存储过程
UPDATE bas_approval SET finish_handle_sp = 'lead_attence.SP_ArchiveRepairForm' WHERE module_no = 'mod11006';
UPDATE bas_approval SET finish_handle_sp = 'lead_attence.SP_ArchiveLeaveForm' WHERE module_no = 'mod11004';
UPDATE bas_approval SET finish_handle_sp = 'lead_attence.SP_ArchiveSwitchForm' WHERE module_no = 'mod11008';
----

已执行：

----101服务器：
Base微服务添加OrgLevel配置

USR_QUESTION_BEHAVIOR=dn1
BIZ_DOCUMENT_USER=dn1
BIZ_ERP_NO=dn1
----

----101数据库：
INSERT INTO MYCAT_SEQUENCE(`name`,current_value,increment) VALUES ('biz_document_user',0,1);
INSERT INTO MYCAT_SEQUENCE(`name`,current_value,increment) VALUES ('usr_question_behavior',0,1);
INSERT INTO MYCAT_SEQUENCE(`name`,current_value,increment) VALUES ('biz_erp_no',0,1);
ALTER TABLE `BIZ_PROJECT` MODIFY COLUMN MACHINE_NAME VARCHAR(500) COMMENT '设备型号'
ALTER TABLE `BIZ_PROJECT` MODIFY COLUMN PROJECT_NAME VARCHAR(550) COMMENT '项目名称'
ALTER TABLE `BIZ_PROJECT_APPLYFORM` MODIFY COLUMN MACHINE_NAME VARCHAR(500) COMMENT '设备型号'
ALTER TABLE `BIZ_PROJECT_APPLYFORM` MODIFY COLUMN PROJECT_NAME VARCHAR(550) COMMENT '项目名称'
ALTER TABLE biz_project_task MODIFY COLUMN ESTIMATE_TIME FLOAT(8, 2) COMMENT '预计总工时';
CREATE TABLE `BIZ_ERP_NO`(
  ID BIGINT PRIMARY KEY AUTO_INCREMENT,
  ERP_NO VARCHAR(20) NOT NULL COMMENT 'ERP号',
  PROJECT_ID VARCHAR(32) NOT NULL COMMENT '项目ID',
  CREATE_DATE DATETIME COMMENT '创建时间',
  UPDATE_DATE DATETIME COMMENT '更新时间'
)


-- 项目名称上拼接设备型号
UPDATE `BIZ_PROJECT` SET PROJECT_NAME = CONCAT(PROJECT_NAME, MACHINE_NAME)
WHERE PROJECT_TYPE IN (1,3)
AND PROJECT_NAME NOT LIKE CONCAT('%', MACHINE_NAME)

-- 项目状态和策划任务状态不匹配
UPDATE `BIZ_PROJECT` SET `STATUS` = 2
WHERE ID IN (
  SELECT PROJECT_ID FROM `BIZ_PROJECT_TASK` WHERE TASK_TYPE = 3 AND PARENT_ID IS NULL AND `STATUS` = 5
)
AND `STATUS` = 1

-- 设备型号"/"改成","
UPDATE `BIZ_PROJECT` SET MACHINE_NAME = REPLACE(MACHINE_NAME,'/',',') WHERE  MACHINE_NAME LIKE '%/%'
-- 项目名称"/"改成","
UPDATE `BIZ_PROJECT` SET PROJECT_NAME = REPLACE(PROJECT_NAME,'/',',') WHERE  PROJECT_NAME LIKE '%/%'
-- 项目名称"&"改成"/"
UPDATE `BIZ_PROJECT` SET PROJECT_NAME = REPLACE(PROJECT_NAME,'&','/') WHERE  PROJECT_NAME LIKE '%&%'
----

补卡：
归档：1、3上，5下， 3，4缺卡标签干掉，补时间；迟到、早退，注意标签

加班：
归档：对应的无效打卡记录（加班）变为有效（考勤规则不允许加班的仍然无效）

出差：
当天：打卡时触发；跨天：job触发

请假：
归档：请假时间范围内，早退、迟到标记取消

调班：
审批之后调整



容器启动顺序（测试环境）：
gitlab
consul
prtainer-test
gateway
jwtserver
pmweb
pmsetting
r-network-services-metadata-1-9c4c5848
focused_roentgen
rabbitmq
basic
project
task
message
document
suggestion
report
performance
attend
general









