# 权限管理

## 目录

1. 工作原理
   - [MySQL权限](#MySQL权限)
2. 账号管理
   - [MySQL账号](#MySQL账号)

## 工作原理

### MySQL权限

两阶段认证：

1. 对连接的用户进行`身份认证`，合法的用户通过认证，不合法的用户拒绝连接
2. 对通过认证的合法用户`赋予相应的权限`，用户可以在这些权限范围内对数据库做相应的操作

对于身份的认证，MySQL 是通过 `IP地址` 和 `用户名` 联合进行确认的。例如 MySQL 安装后默认创建的用户 `root@localhost` 表示用户 root 只能从本地(localhost)进行连接才可以通过认证，此用户从其他任何主机对数据库进行的连接都将被拒绝。也就是说，同样的一个用户名，如果来自不同的IP地址，则 MySQL 将其视为不同的用户。

在权限存取的两个过程中，系统会用到 `mysql` 数据库中 `user`、`host` 和 `db` 这 3 个最重要的权限表

当用户进行连接的时候，权限表的存取过程有以下两个阶段.

1. 先从 `user` 表中的 `host`、`user` 和 `password` 这 3 个字段中判断连接的IP、用户名和密码是否存在于表中，如果存在，则通过身份验证，否则拒绝连接。
2. 如果通过身份验证，则按照以下权限表的顺序得到数据库权限：user -> db -> tables_priv -> columns_priv。在这几个权限表中，权限范围依次递减，全局权限覆盖局部权限。

## 账号管理

### MySQL账号

```sql
-- 创建账号
-- 创建用户colin，权限为可以在所有数据库上执行所有极限，只能从本地进行连接
create user 'colin'@'localhost' identified by '052152';
grant all on *.* to 'colin'@'localhost';
-- 可以发现，除了 Grant_priv 权限外，所有权限在 user 表里面都是"Y"
-- 增加 grant 权限
grant all privileges on *.* to 'colin'@'localhost' with grant option;

-- 创建新用户angel1，可以从任何IP进行连接
create user 'angel1'@'%' identified by '123456';
-- 权限为对wxdh数据库里的所有表进行SELECT、UPDATE、INSERT和DELETE操作
grant select, insert, update, delete on wxdh.* to 'angel1'@'%';

-- 授予SUPER、PROCESS、FTLE权限给用户angel1@%
-- 因为这几个权限都阔于管理权限，因此不能够指定数据库
grant super, process, file on *.* to 'angel1'@'%';

-- 只授予登录权限
grant usage on *.* to 'angel2'@'localhost';

-- 刷新权限
flush privileges;

-- 查看权限
show grants for 'angel1'@'%';
-- 或者
use information_schema;
select * from SCHEMA_PRIVILEGES where grantee="'angel1'@'%'";

-- 回收权限
-- 登录权限usage不能回收
revoke all privileges, grant option from 'colin'@'localhost';
revoke insert, update, delete on wxdh.* from 'angel1'@'%';
```

`GRANT` 操作的本质就是修改权限表后进行权限的刷新。
