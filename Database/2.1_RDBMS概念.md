# RDBMS概念

RDBMS代表关系数据库管理系统。RDBMS是SQL的基础，对于像MS SQL Server，IBM DB2，Oracle，MySQL和Microsoft Access等所有现代数据库系统。

一个关系数据库管理系统(RDBMS)是一个数据库管理系统(DBMS)，基于关系模型如通过 E. F. Codd 引入。

**什么是表？**

在RDBMS中的数据存储在数据库对象称为表。表是相关数据条目的集合，它由列和行的组成。

记住，表是数据存储在关系数据库中最常见和最简单的形式。以下是CUSTOMERS表的例子：

![x](./Resource/2.jpg)

**什么是字段？**

每个表被分成较小的实体称为字段。在CUSTOMERS表中的字段组成是：ID, NAME, AGE, ADDRESS 和 SALARY。

字段旨在维护有关表中的每个记录特定信息表中的列。

**什么是记录或行？**

一个记录，也被称为一行数据，是存在于一个表中的每个单独的条目。比如有7条记录在上面的CUSTOMERS表。以下是在CUSTOMERS表中的数据或记录中的一行：

![x](./Resource/3.jpg)

记录是表中的一个水平的实体。

**什么是列？**

列是包含在一个表中的特定字段相关联的所有信息表的垂直实体。

例如，在CUSTOMERS表中的一列是ADDRESS，它代表位置描述，并会包括以下内容：

![x](./Resource/4.jpg)

**什么是NULL值？**

在表中的NULL值是一个字段显示为空值，这意味着使用一个NULL值的字段是表示一个没有值的字段。

这是非常重要的是要明白，一个NULL值不同于零值或包含空格的字段。NULL值字段是一个记录创建过程中已经留为空白。

**SQL 约束:**

约束是对表执行对数据的列的规则。这些用于限制数据的类型进入表中。这确保数据库中的数据的准确性和可靠性。

约束可能是列级或表级。列级约束仅应用于一列，表级约束应用于整个表。

下面是常用的SQL约束：

- [NOT NULL约束](http://www.yiibai.com/sql/sql-not-null.html) - 确保列不能有NULL值
- [默认值约束](http://www.yiibai.com/sql/sql-default.html) - 提供未指定时为列的值时的默认值
- [唯一值约束](http://www.yiibai.com/sql/sql-unique.html) - 确保了在一列中的所有的值是唯一的
- [主键](http://www.yiibai.com/sql/sql-primary-key.html) - 唯一标识数据库表中的每一行/记录
- [外键](http://www.yiibai.com/sql/sql-foreign-key.html) - 唯一标识任何其他数据库表中的行/记录
- [检查约束](http://www.yiibai.com/sql/sql-check.html) - CHECK约束可以确保列中的所有值满足一定的条件
- [索引](http://www.yiibai.com/sql/sql-index.html) - 使用非常快速地创建和检索数据库中的数据。

**数据完整性：**

数据的完整性有以下几类存在于每个RDBMS：

- 实体完整性: 表中没有重复行
- 域完整性: 通过限制的类型，格式或值的范围强制对于一个给定列的有效条目
- 参考完整性: 行不能被删除，被其他记录使用
- 用户定义的完整性: 强制执行不属于实体，域和参照完整性一些具体的业务规则

## SQL92标准

- 数据操作语句(Data Manipulation Language, DML) select,insert,update,delete
- 数据定义语句(Data Definition Language, DDL) create drop
- 数据控制语句(Data Control Language, DCL) grant,revoke

## SQL99标准

类型|简介|命令举例
-|-|-
SQL连接语句|开始和结束一个客户连接|connect,disconnect
SQL控制语句|控制一组SQL语句的执行|call,return
SQL数据语句|直接对数据产生持续性作用|select,insert,update,delete
SQL诊断语句|提供诊断信息并抛出异常或错误|get,diagnostic
SQL模式语句|对数据库模式及其内的对象产生持续性作用|alter,create,drop
SQL会话语句|在一次会话中，控制缺省操作和其它操作|set
SQL事务语句|设置一个事务处理的开始和结束点|commit,rollback

SQL程序以数据的逻辑集合来对数据进行操作。集合处理方式也称作声明性处理(Declarative Processing)。集合理论是俄国数学家格奥尔格•康托(Georg Cantor)的发明。

## 数据库范式

第一范式：

- 内容相似的数据列必须消除
- 必须为每一组相关数据分别创建一个数据表
- 每条数据记录必须用一个主键来标识

>字段具有原子性，不可再分。所有关系型数据库系统都满足第一范式
>
>数据库表中的字段都是单一属性的，不可再分。例如，姓名字段，其中的姓和名必须作为一个整体，无法区分哪部分是姓，哪部分是名，如果要区分出姓和名，必须设计成两个独立的字段。

第二范式：

- 只要数据列里的内容出现重复，就意味着应该把数据表拆分为多个子表
- 拆分形成的数据表必须用外键关联起来

>第二范式（2NF）是在第一范式（1NF）的基础上建立起来的，即满足第二范式（2NF）必须先满足第一范式（1NF）。
>
>要求数据库表中的每个实例或行必须可以被惟一地区分。通常需要为表加上一个列，以存储各个实例的惟一标识。这个惟一属性列被称为主关键字或主键。
>
>第二范式（2NF）要求实体的属性完全依赖于主关键字。所谓完全依赖是指不能存在仅依赖主关键字一部分的属性，如果存在，那么这个属性和主关键字的这一部分应该分离出来形成一个新的实体，新实体与原实体之间是一对多的关系。为实现区分通常需要为表加上一个列，以存储各个实例的惟一标识。简而言之，第二范式就是非主属性非部分依赖于主关键字。

第三范式：

- 与主键没有直接关系的数据列必须消除

>第三范式的要求如下：
>
>满足第三范式（3NF）必须先满足第二范式（2NF）。简而言之，第三范式（3NF）要求一个数据库表中不包含已在其它表中已包含的非主关键字信息。
>
>所以第三范式具有如下特征：
>
>1、每一列只有一个值  
>2、每一行都能区分。  
>3、每一个表都不包含其他表已经包含的非主关键字信息。  
>
>例如，帖子表中只能出现发帖人的id，而不能出现发帖人的id，还同时出现发帖人姓名，否则，只要出现同一发帖人id的所有记录，它们中的姓名部分都必须严格保持一致，这就是数据冗余。


基本语句
	确定数据表里有多少条记录(COUNT)
	确定数据表里有多少条内容不重复的数据记录(DISTINCT)
	对查询结果进行排序(ORDER BY、ASC、DESC)
	筛选数据记录(WHERE、HAVING)
	涉及多个数据表的关联查询(LEFT/RIGHT JOIN)
	合并查询结果(UNION)
	分组查询(GROUP BY)，统计函数(SUM、MAX、MIN、COUNT)
	修改数据(INSERT、UPDATE、DELETE)
	创建数据表、数据库和索引
即使没有ORDER BY语句，SELECT查询结果的排列顺序也不是随机的——它们将按照在数据表的存储顺序排列。但是作为众多用户中的一员，对这个顺序恐怕并没有什么影响力。
排序方式的选择（优先级从高到低）：
	创建数据表时为有关数据列设置的排序方式
	数据表上的排序方式
	数据库上的排序方式
	数据列使用的字符集的默认排序方式
查看某个字符集的默认排序方式
SHOW CHARACTER SET
查看当前字符集的排序方式
SHOW COLLATE
临时改用另外一种排序方式对查询结果进行排序（COLLATE），这种临时排序不会使用任何索引，因此很没有效率
SELECT column FROM table ORDER BY column COLLATE latin1_german2_ci
永久改变某个数据列的排序方式，相关索引会自动更新
ALTER TABLE table MODIFY column VARCHAR(60) CHARACTER SET latin1 COLLATE latin1_german2_ci
如果给定数据列的排序方式里没有所需要的，可以用CONVERT命令临时指定另外一种字符集，当然，效率不敢恭维
SELECT column FROM table ORDER BY CONVERT(column USING utf8) COLLATE utf8_polish_ci
使用LIKE操作符进行的比较操作在比较大的数据表上往往非常慢，因为需要全表扫描，无法用索引优化！这种查询往往可以优化为一个利用全文索引进行的全文检索查询。
查询语句中同时出现WHERE和HAVING时，优先执行WHERE字句，HAVING字句相当于二次筛选。HAVING关键字一般和分组GROUP BY一起使用，但是不容易优化，应该尽量避免使用。


## 数据库设计技巧

- 表里没有冗余数据
- 表里没有不确定列（order1、order2 …）
- 全体数据表空间占用总量越小越好
- 使用频率高的数据库查询都能以简单高效的方式执行

### 起名

- 列名不区分大小写，表名和库名区分大小写
- 库、表、列名最多64个字符
- 避免使用特殊字符
- 名字有意义
- 按照一定规范（分隔符、单复数）

### 范式
	第一范式
	内容相似的数据列必须消除
	必须为每一组相关数据分别创建一个数据表
	每条数据记录必须用一个主键来标识
	第二范式
	只要数据列里的内容出现重复，就意味着应该把数据表拆分为多个子表
	拆分形成的数据表必须用外键关联起来
	第三范式
	与主键没有直接关系的数据列必须消除
关系
	1:1
	1:n
	n:m
主键
	主键必须唯一
	主键应该紧凑（自增数字）
外键
	只在为了保证数据完整性时，才用
	外键约束：
	FOREIGN KEY [name] (column1) REFERENCES table2 (column2)
		[ON DELETE {CASCADE | SET NULL | NO ACTION | RESTRICT}]
		[ON UPDATE {CASCADE | SET NULL | NO ACTION | RESTRICT}]
	设置前提：
	必须配有至少一个普通索引。联合索引时，必须为第一个
	数据类型匹配
